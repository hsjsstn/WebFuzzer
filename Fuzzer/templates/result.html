<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Web Fuzzer - ê²°ê³¼</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='header.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}">
</head>
<body>
  {% include 'header.html' %}

  <h2>í¼ì§• ê²°ê³¼</h2>

  <div class="button-row">
    <a href="{{ url_for('download_pdf') }}">
      <button class="btn-download">PDF ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ</button>
    </a>
    <a href="{{ url_for('download_logs') }}">
      <button class="btn-download">ë¡œê·¸ TXT íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
    </a>
    <!-- <button id="analyze-btn">AI ìš”ì•½ ë° ëŒ€ì‘ ê°€ì´ë“œ</button> -->
  </div>

  <!-- ğŸ” AI ìš”ì•½ ê²°ê³¼ ìœ„ì¹˜ë¥¼ ìœ„ë¡œ -->
  <!-- <div id="ai-summary" class="ai-summary"></div> -->

  <!-- ğŸ”’ ìˆ¨ê²¨ì§„ í…ìŠ¤íŠ¸ ë¸”ë¡ -->
  <!-- {% if vulnerabilities %}
  <div id="vuln-results" style="display:none;">
    {% for v in vulnerabilities %}
- URL: {{ v.form }}
  - ìœ í˜•: {{ v.type }}
  - í˜ì´ë¡œë“œ: {{ v.payload }}

    {% endfor %}
  </div>
  {% endif %} -->

  <h2>ë°œê²¬ëœ ì·¨ì•½ì </h2>

  {% if vulnerabilities %}
  <table>
    <thead>
      <tr>
        <th>ëŒ€ìƒ URL</th>
        <th>ì·¨ì•½ì  ìœ í˜•</th>
        <th>í˜ì´ë¡œë“œ</th>
      </tr>
    </thead>
    <tbody>
      {% for v in vulnerabilities %}
        <tr>
          <td>{{ v.form }}</td>
          <td>{{ v.type }}</td>
          <td>{{ v.payload }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p style="text-align:center; color:#aaa;">ë°œê²¬ëœ ì·¨ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}

  {% include 'footer.html' %}

  <script>
  window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("analyze-btn").addEventListener("click", async () => {
      console.log("ë²„íŠ¼ í´ë¦­ë¨");

      const vulnText = document.getElementById("vuln-results").innerText;
      console.log("ìš”ì•½í•  í…ìŠ¤íŠ¸:", vulnText);

      const response = await fetch("http://127.0.0.1:5001", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ content: vulnText })
      });

      const data = await response.json();
      console.log("AI ì‘ë‹µ:", data);

      document.getElementById("ai-summary").innerText = data.choices[0].message.content;
    });
  });
</script>
</body>
</html>